---
title: "05_poppR"
format: html
editor: visual
---

## Analysis of multilocus lineages using **poppr** package

```{r}
#install.packages("poppr")
#install.packages("here")
library(poppr)
library(here)
library(dartRverse)
```

```{r}
library(here)
getwd()

# for a Genepop .gen file
genind_obj <- import2genind(here::here("project/output", "genepop_final.gen"))

head(genind_obj)
unique(genind_obj@pop)
```

```{r}
### From Bryan
genlight_clones <- gi2gl(genind_obj) #genind to genlight

## Choosing a threshold
thresholds <- filter_stats(genlight_clones,  plot = TRUE)
#print(thresholds)
str(thresholds)

print(farthest_thresh <- cutoff_predictor(thresholds$farthest$THRESHOLDS))
print(average_thresh <- cutoff_predictor(thresholds$average$THRESHOLDS))
print(nearest_thresh <- cutoff_predictor(thresholds$nearest$THRESHOLDS))

gi <- gl2gi(genlight_clones)
gc <- as.genclone(gi, mlgclass = TRUE)

strata(gc) <- data.frame(pop(genlight_clones))

## Removing Clones
mlg.filter(gc, distance = nei.dist, missing = "mean") <- nearest_thresh

genind_final_cc <- clonecorrect(gc) # Actually remove clones with poppr

filter_stats(genind_final_cc, plot = T)
```

```{r}
citation(package = "poppr")
```
